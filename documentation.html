

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Documentation &mdash; RADON  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Examples" href="examples.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> RADON
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="business-value.html">Business value</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ci-cd">CI/CD</a></li>
<li class="toctree-l2"><a class="reference internal" href="#monitoring">Monitoring</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#monitoring-an-aws-lambda-function">Monitoring an AWS Lambda function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#monitoring-extracting-metrics-from-application-logs">Monitoring &amp; extracting metrics from application logs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#orchestrator">Orchestrator</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">RADON</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/documentation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="documentation">
<span id="id1"></span><h1>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h1>
<p>This part further explains the structure and usage of the RADON Delivery toolchain.</p>
<div class="section" id="ci-cd">
<span id="id2"></span><h2>CI/CD<a class="headerlink" href="#ci-cd" title="Permalink to this headline">¶</a></h2>
<p>Continuous Delivery is an essential part of RADON. This means rapid, incremental changes to Serverless Applications. Doing so demands a specific focus on automation.</p>
<blockquote>
<div><ul class="simple">
<li><p>For Continuous Integration, we want to be able to automate the necessary tollgates for quality validation and branch integration.</p></li>
<li><p>For Continuous Deployment, we want to automate the necessary release criterias and create a fail-safe environment.</p></li>
</ul>
</div></blockquote>
<p>Combined we achieve our ambition of reduced lead time and value to the end user.</p>
<p>Technically, this is achieved by utilizing the full framework of Radon. Within the framework you find all the necessary components for quality assurance, deployment, testing and monitoring. Including these tools in a CI/CD pipeline will assure automation and increase velocity.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline</span> <span class="p">{</span>
    <span class="n">agent</span> <span class="nb">any</span>
    <span class="n">environment</span> <span class="p">{</span>
        <span class="n">AWS_ACCESS_KEY_ID</span>     <span class="o">=</span> <span class="n">credentials</span><span class="p">(</span><span class="s1">&#39;aws-id&#39;</span><span class="p">)</span>
        <span class="n">AWS_SECRET_ACCESS_KEY</span> <span class="o">=</span> <span class="n">credentials</span><span class="p">(</span><span class="s1">&#39;aws-secret&#39;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">stages</span> <span class="p">{</span>
        <span class="n">stage</span><span class="p">(</span><span class="s1">&#39;Defect prediction&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>
                <span class="o">//</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">radon</span><span class="o">-</span><span class="n">h2020</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">radon</span><span class="o">-</span><span class="n">defect</span><span class="o">-</span><span class="n">prediction</span><span class="o">-</span><span class="n">api</span><span class="o">/</span>
                <span class="n">sh</span> <span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">p</span> <span class="mi">5000</span><span class="p">:</span><span class="mi">5000</span> <span class="n">radon</span><span class="o">-</span><span class="n">dp</span><span class="p">:</span><span class="n">latest</span>
                <span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="s2">&quot;http://localhost:5000/api/classification/classify&quot;</span> <span class="o">-</span><span class="n">H</span>  <span class="s2">&quot;accept: */*&quot;</span> <span class="o">-</span><span class="n">H</span>  <span class="s2">&quot;Content-Type: plain/text&quot;</span> <span class="o">-</span><span class="n">d</span> <span class="s2">&quot;- host: all&quot;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">stage</span><span class="p">(</span><span class="s1">&#39;Deploy resources&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">environment</span> <span class="p">{</span>
                <span class="n">DEPLOY_FILE</span> <span class="o">=</span> <span class="s1">&#39;_definitions/radonlegacyblueprints__ImageResize.tosca&#39;</span>
            <span class="p">}</span>
            <span class="n">steps</span> <span class="p">{</span>
                <span class="n">sh</span> <span class="s1">&#39;unzip -o ImageResize.csar&#39;</span>
                <span class="n">sh</span> <span class="s1">&#39;opera deploy $DEPLOY_FILE&#39;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">stages</span> <span class="p">{</span>
        <span class="n">stage</span><span class="p">(</span><span class="s1">&#39;Testing&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">steps</span> <span class="p">{</span>
                <span class="o">//</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">continuous</span><span class="o">-</span><span class="n">testing</span><span class="o">-</span><span class="n">tool</span><span class="o">.</span><span class="n">readthedocs</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">en</span><span class="o">/</span><span class="n">latest</span><span class="o">/</span>
                <span class="n">sh</span> <span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">t</span> <span class="o">-</span><span class="n">i</span> <span class="o">--</span><span class="n">name</span> <span class="n">RadonCTT</span> <span class="o">-</span><span class="n">p</span> <span class="mi">18080</span><span class="p">:</span><span class="mi">18080</span> <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">sock</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">docker</span><span class="o">.</span><span class="n">sock</span> <span class="n">radonconsortium</span><span class="o">/</span><span class="n">radon</span><span class="o">-</span><span class="n">ctt</span><span class="p">:</span><span class="n">latest</span>
                <span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="s2">&quot;http://localhost:18080/RadonCTT/project&quot;</span> <span class="o">-</span><span class="n">H</span>  <span class="s2">&quot;accept: */*&quot;</span> <span class="o">-</span><span class="n">H</span>  <span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="o">-</span><span class="n">d</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">name</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">SockShop</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">repository_url</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">https://github.com/radon-h2020/demo-ctt-sockshop.git</span><span class="se">\&quot;</span><span class="s2">}&quot;</span>
                <span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="s2">&quot;http://localhost:18080/RadonCTT/deployment&quot;</span> <span class="o">-</span><span class="n">H</span>  <span class="s2">&quot;accept: */*&quot;</span> <span class="o">-</span><span class="n">H</span>  <span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="o">-</span><span class="n">d</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">testartifact_uuid</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">87a2d052-93ce-43d2-b765-74b0cef9df92</span><span class="se">\&quot;</span><span class="s2">}&quot;</span>
                <span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="s2">&quot;http://localhost:18080/RadonCTT/execution&quot;</span> <span class="o">-</span><span class="n">H</span>  <span class="s2">&quot;accept: */*&quot;</span> <span class="o">-</span><span class="n">H</span>  <span class="s2">&quot;Content-Type: application/json&quot;</span> <span class="o">-</span><span class="n">d</span> <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">deployment_uuid</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">5f435990-8a1a-4741-a040-6db2fe552603</span><span class="se">\&quot;</span><span class="s2">}&quot;</span>

            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="monitoring">
<span id="id3"></span><h2>Monitoring<a class="headerlink" href="#monitoring" title="Permalink to this headline">¶</a></h2>
<p>This section explains the installation and usage of RADON monitoring tool.</p>
<div class="section" id="monitoring-an-aws-lambda-function">
<h3>Monitoring an AWS Lambda function<a class="headerlink" href="#monitoring-an-aws-lambda-function" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><p>Prometheus Pushgateway</p></li>
</ul>
</div></blockquote>
<p>The Prometheus Pushgateway exists to allow ephemeral and batch jobs to expose their metrics to Prometheus.
Since these kinds of jobs may not exist long enough to be scraped, they can instead push their metrics
to a Pushgateway. The Pushgateway then exposes these metrics to Prometheus.</p>
<p>A service template in TOSCA for the push gateway, part of the RADON monitoring tool, is available at:
<a class="reference external" href="https://github.com/radon-h2020/radon-monitoring-tool/blob/master/service.yml">https://github.com/radon-h2020/radon-monitoring-tool/blob/master/service.yml</a>. You can try to deploy it with xOpera like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ OPERA_SSH_USER=xxx opera deploy service.yml
</pre></div>
</div>
<p>It installs a push gateway instance and automatically advertises its endpoint
on the RADON service discovery agent. Then the RADON Prometheus server will auto discover the newly
registered/advertised push gateway endpoint and start scraping it to collect exposed metrics.
The exposed metrics are then available on the visualisation dashboard.</p>
<blockquote>
<div><ul class="simple">
<li><p>RADON Monitoring client</p></li>
</ul>
</div></blockquote>
<p>To monitor an AWS Lambda function import the RADON monitoring lib
(<a class="reference external" href="https://github.com/radon-h2020/radon-monitoring-tool/blob/master/lambda/python-runtime/monitoring_lib.py">https://github.com/radon-h2020/radon-monitoring-tool/blob/master/lambda/python-runtime/monitoring_lib.py</a>) and simply annotate the
lambda_function:::lambda_handler, i.e:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">monitoring_lib</span> <span class="k">import</span> <span class="n">monitor_cpu</span><span class="p">,</span> <span class="n">monitor_ram</span>

<span class="nd">@monitor_cpu</span>
<span class="nd">@monitor_ram</span>
<span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
</pre></div>
</div>
<p>The dependencies can be provided to AWS Lambda via layer like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install --target ./package/python prometheus_pushgateway
$ pip install --target ./package/python psutil
$ zip -r9 function.zip package/
$ aws lambda publish-layer-version --layer-name monitoring_client --zip-file fileb://function.zip --compatible-runtimes ruby2.5
</pre></div>
</div>
<p>or packaged with the lambda code or simply reference a public available layer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">arn</span><span class="p">:</span><span class="n">aws</span><span class="p">:</span><span class="k">lambda</span><span class="p">:</span><span class="n">eu</span><span class="o">-</span><span class="n">central</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">510790361559</span><span class="p">:</span><span class="n">layer</span><span class="p">:</span><span class="n">radon_monitoring_client</span><span class="p">:</span><span class="mi">2</span>
</pre></div>
</div>
<p>The RADON monitoring client needs to be registered to its corresponding push gateway component. This is achieved
by injecting an Environment variable to the AWS Lambda function with key: PUSH_GATEWAY_HOST.</p>
</div>
<div class="section" id="monitoring-extracting-metrics-from-application-logs">
<h3>Monitoring &amp; extracting metrics from application logs<a class="headerlink" href="#monitoring-extracting-metrics-from-application-logs" title="Permalink to this headline">¶</a></h3>
<p>Extracting Prometheus metrics from application logs is supported in RADON using Google’s <a class="reference external" href="https://github.com/google/mtail">mtail</a> tool.
mtail acts as a Prometheus exporter so it is fully compliant with the RADON Monitoring tool which is based on Prometheus toolkit.
A TOSCA service template for deploying the mtail component and transparently integrate it to the RADON central Prometheus server is available
at <a class="reference external" href="https://github.com/radon-h2020/radon-monitoring-tool/blob/master/service.yml">https://github.com/radon-h2020/radon-monitoring-tool/blob/master/service.yml</a>. It can be deployed with the RADON
xOpera orchestrator on any server running a Docker runtime, as usual:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ OPERA_SSH_USER=xxx opera deploy service.yml
</pre></div>
</div>
<p>In terms of configuration needed, a user should specify the path of the log file to be monitored/analysed in the command of the corresponding docker compose file (–logs):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">command</span><span class="p">:</span>
  <span class="s2">&quot;-logtostderr --progs /progs/gauge.mtail --logs /logs/foo.log --poll_interval 250ms&quot;</span>
</pre></div>
</div>
<p>mtail continuously tails and parses the log file and on each log record it applies a RegEx rule to extract the monitoring metrics of interest.
A sample mtail config file is available at:  <a class="reference external" href="https://github.com/radon-h2020/radon-monitoring-tool/blob/master/gauge.mtail">https://github.com/radon-h2020/radon-monitoring-tool/blob/master/gauge.mtail</a>.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>gauge val_acc

/validation accuracy (\d+)/ {
  # Parse log record and export validation accuracy value.
  val_acc = $1
}
</pre></div>
</div>
<p>It filters log records containing the pattern: ‘validation accuracy (d+)’ and exposes the value to the Prometheus and consequently to the Grafana for visualization of the monitored metrics.
Please refer to mtail’s <a class="reference external" href="https://github.com/google/mtail/blob/master/docs/Programming-Guide.md">Programming Guide</a> for details.</p>
</div>
</div>
<div class="section" id="orchestrator">
<span id="id5"></span><h2>Orchestrator<a class="headerlink" href="#orchestrator" title="Permalink to this headline">¶</a></h2>
<p>You can find xOpera’s documentation here: <a class="reference external" href="https://xlab-si.github.io/xopera-docs/">xOpera docs</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="examples.html" class="btn btn-neutral float-left" title="Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, RADON team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>